<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Annotate the Plot • spiralize</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Annotate the Plot">
<meta property="og:description" content="spiralize">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">spiralize</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.99.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/spiralize.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/annotate.html">Annotate the Plot</a>
    </li>
    <li>
      <a href="../articles/examples.html">Real World Examples</a>
    </li>
    <li>
      <a href="../articles/special_data_type.html">Initialize Spirals by Special Data Types</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/jokergoo/spiralize/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="annotate_files/header-attrs-2.8/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Annotate the Plot</h1>
                        <h4 class="author">Zuguang Gu (<a href="mailto:z.gu@dkfz.de" class="email">z.gu@dkfz.de</a>)</h4>
            
            <h4 class="date">2021-06-25</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/jokergoo/spiralize/blob/master/vignettes/annotate.Rmd"><code>vignettes/annotate.Rmd</code></a></small>
      <div class="hidden name"><code>annotate.Rmd</code></div>

    </div>

    
    
<p>In this vignette, I demonstrate how to add text and legend to the spiral plot.</p>
<div id="text" class="section level2">
<h2 class="hasAnchor">
<a href="#text" class="anchor"></a>Text</h2>
<p><strong>spiralize</strong> is implemented under <strong>grid</strong> graphics system, thus functions from <strong>grid</strong> need to be used with <strong>spiralize</strong>.</p>
<p>The spiral plot is drawn in a square viewport, as shown in the following figure, thus, simply you can use <code>grid.text()</code> to add text to a specific position.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jokergoo/spiralize">spiralize</a></span><span class="op">)</span>
<span class="fu"><a href="../reference/spiral_initialize.html">spiral_initialize</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="../reference/spiral_track.html">spiral_track</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu">grid.rect</span><span class="op">(</span>gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span><span class="op">)</span>
<span class="fu">grid.text</span><span class="op">(</span><span class="st">"center"</span>, <span class="fl">0</span>, <span class="fl">0</span>, default.units <span class="op">=</span> <span class="st">"native"</span><span class="op">)</span>
<span class="fu">grid.text</span><span class="op">(</span><span class="st">"top_left"</span>, <span class="fl">0</span>, <span class="fl">1</span>, default.units <span class="op">=</span> <span class="st">"npc"</span>, just <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"left"</span>, <span class="st">"top"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="annotate_files/figure-html/unnamed-chunk-3-1.png" width="480" style="display: block; margin: auto;"></p>
<p>For time series data, users might want to add texts to describe different “seasons/sectors”. In the following example, assume period is day, I add hour names to the corresponding sectors in the polar coordinate system. I also add text to the start and end of the spiral.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/spiral_initialize_by_time.html">spiral_initialize_by_time</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"2021-01-01 00:00:00"</span>, <span class="st">"2021-01-04 23:59:59"</span><span class="op">)</span>, padding <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">2</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## 'unit_to_axis' is set to 'mins'.
## 'period' is set to 'days'.</code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/spiral_track.html">spiral_track</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">s</span> <span class="op">=</span> <span class="fu"><a href="../reference/current_spiral.html">current_spiral</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">d</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">360</span><span class="op">/</span><span class="fl">24</span><span class="op">/</span><span class="fl">2</span>, <span class="fl">360</span>, by <span class="op">=</span> <span class="fl">360</span><span class="op">/</span><span class="fl">24</span><span class="op">)</span> <span class="op">%%</span> <span class="fl">360</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">df</span> <span class="op">=</span> <span class="fu"><a href="../reference/polar_to_cartesian.html">polar_to_cartesian</a></span><span class="op">(</span><span class="va">d</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">/</span><span class="fl">180</span><span class="op">*</span><span class="va">pi</span>, <span class="op">(</span><span class="va">s</span><span class="op">$</span><span class="va">max_radius</span> <span class="op">+</span> <span class="fl">1.5</span><span class="op">)</span><span class="op">)</span>
    <span class="fu">grid.text</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">i</span>, <span class="st">"h"</span><span class="op">)</span>, x <span class="op">=</span> <span class="va">df</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span>, y <span class="op">=</span> <span class="va">df</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">]</span>, default.unit <span class="op">=</span> <span class="st">"native"</span>,
        rot <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">d</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">d</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;</span> <span class="fl">180</span>, <span class="va">d</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">-</span> <span class="fl">90</span>, <span class="va">d</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">+</span> <span class="fl">90</span><span class="op">)</span>, gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>fontsize <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">x</span> <span class="op">=</span> <span class="va">s</span><span class="op">$</span><span class="fu">get_numeric_x</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"2021-01-01 00:00:00"</span>, <span class="st">"2021-01-04 23:59:59"</span><span class="op">)</span><span class="op">)</span>
<span class="va">df</span> <span class="op">=</span> <span class="fu"><a href="../reference/xy_to_cartesian.html">xy_to_cartesian</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">0.5</span><span class="op">)</span>
<span class="fu">grid.text</span><span class="op">(</span><span class="st">"2012-01-01\n00:00:00"</span>, <span class="va">df</span><span class="op">$</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">df</span><span class="op">$</span><span class="va">y</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, default.units <span class="op">=</span> <span class="st">"native"</span>, vjust <span class="op">=</span> <span class="fl">1.2</span>,
    gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>fontsize <span class="op">=</span> <span class="fl">8</span><span class="op">)</span><span class="op">)</span>
<span class="fu">grid.text</span><span class="op">(</span><span class="st">"2012-04-01\n23:59:59"</span>, <span class="va">df</span><span class="op">$</span><span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">df</span><span class="op">$</span><span class="va">y</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, default.units <span class="op">=</span> <span class="st">"native"</span>, vjust <span class="op">=</span> <span class="op">-</span><span class="fl">0.2</span>,
    gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>fontsize <span class="op">=</span> <span class="fl">8</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="annotate_files/figure-html/unnamed-chunk-4-1.png" width="480" style="display: block; margin: auto;"></p>
<p>The drawback of the previous plot is e.g. 1h and 2h are too far away to the spiral. Users might want to put the text closer to the spiral. This can be done by just drawing text in the track, but with <em>y</em>-locations larger than the maximal <em>y</em>-location in the track (drawing above the plot region of the track).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/spiral_initialize_by_time.html">spiral_initialize_by_time</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"2021-01-01 00:00:00"</span>, <span class="st">"2021-01-04 23:59:59"</span><span class="op">)</span>, padding <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">1</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## 'unit_to_axis' is set to 'mins'.
## 'period' is set to 'days'.</code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/spiral_track.html">spiral_track</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># ymax of the track is 1, but here we draw the text at y = 1.5</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org">lubridate</a></span><span class="op">)</span>
<span class="fu"><a href="../reference/spiral_text.html">spiral_text</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html">as.POSIXlt</a></span><span class="op">(</span><span class="st">"2021-01-04 00:30:00"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/period.html">hours</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">23</span><span class="op">)</span>, y <span class="op">=</span> <span class="fl">1.5</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">24</span>, <span class="st">"h"</span><span class="op">)</span>, gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>fontsize <span class="op">=</span> <span class="fl">8</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="../reference/spiral_text.html">spiral_text</a></span><span class="op">(</span><span class="st">"2021-01-01 00:00:00"</span>, <span class="fl">0.5</span>, <span class="st">"01-01"</span>, gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>fontsize <span class="op">=</span> <span class="fl">8</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="../reference/spiral_text.html">spiral_text</a></span><span class="op">(</span><span class="st">"2021-01-02 00:00:00"</span>, <span class="fl">0.5</span>, <span class="st">"01-02"</span>, gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>fontsize <span class="op">=</span> <span class="fl">8</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="../reference/spiral_text.html">spiral_text</a></span><span class="op">(</span><span class="st">"2021-01-03 00:00:00"</span>, <span class="fl">0.5</span>, <span class="st">"01-03"</span>, gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>fontsize <span class="op">=</span> <span class="fl">8</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="../reference/spiral_text.html">spiral_text</a></span><span class="op">(</span><span class="st">"2021-01-04 00:00:00"</span>, <span class="fl">0.5</span>, <span class="st">"01-04"</span>, gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>fontsize <span class="op">=</span> <span class="fl">8</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="annotate_files/figure-html/unnamed-chunk-5-1.png" width="480" style="display: block; margin: auto;"></p>
</div>
<div id="legend" class="section level2">
<h2 class="hasAnchor">
<a href="#legend" class="anchor"></a>Legend</h2>
<p>Legends are important graphics elements in a plot which guild users to understand the plot. <strong>spiralize</strong> does not directly draw legends, but it can be very easily done with other legend functions, such as <code><a href="https://rdrr.io/pkg/ComplexHeatmap/man/Legend.html">Legend()</a></code> and <code><a href="https://rdrr.io/pkg/ComplexHeatmap/man/packLegend.html">packLegend()</a></code> from <strong>ComplexHeatmap</strong> package.</p>
<p><code><a href="https://rdrr.io/pkg/ComplexHeatmap/man/Legend.html">Legend()</a></code> creates a single legend, either continuous or discrete, and <code><a href="https://rdrr.io/pkg/ComplexHeatmap/man/packLegend.html">packLegend()</a></code> combines a list of legends into a single object. Check the following example:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">n</span> <span class="op">=</span> <span class="fl">1000</span>
<span class="fu"><a href="../reference/spiral_initialize.html">spiral_initialize</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="../reference/spiral_track.html">spiral_track</a></span><span class="op">(</span>height <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span>

<span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>
<span class="va">col_fun</span> <span class="op">=</span> <span class="fu">circlize</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/circlize/man/colorRamp2.html">colorRamp2</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span>, <span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"green"</span>, <span class="st">"white"</span>, <span class="st">"red"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="../reference/spiral_rect.html">spiral_rect</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n</span> <span class="op">-</span> <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">:</span><span class="va">n</span>, <span class="fl">1</span>, gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>fill <span class="op">=</span> <span class="fu">col_fun</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, col <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="../reference/spiral_highlight.html">spiral_highlight</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">100</span>, type <span class="op">=</span> <span class="st">"line"</span>, gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>col <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="../reference/spiral_highlight.html">spiral_highlight</a></span><span class="op">(</span><span class="fl">500</span>, <span class="fl">700</span>, type <span class="op">=</span> <span class="st">"line"</span>, gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>col <span class="op">=</span> <span class="st">"purple"</span><span class="op">)</span><span class="op">)</span>

<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jokergoo/ComplexHeatmap">ComplexHeatmap</a></span><span class="op">)</span>
<span class="va">lgd</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/packLegend.html">packLegend</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/Legend.html">Legend</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"title1"</span>, col_fun <span class="op">=</span> <span class="va">col_fun</span><span class="op">)</span>,
    <span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/Legend.html">Legend</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"title2"</span>, type <span class="op">=</span> <span class="st">"lines"</span>, legend_gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"purple"</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,
        at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"text1"</span>, <span class="st">"text2"</span><span class="op">)</span><span class="op">)</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/draw-dispatch.html">draw</a></span><span class="op">(</span><span class="va">lgd</span>, x <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">1</span>, <span class="st">"npc"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">2</span>, <span class="st">"mm"</span><span class="op">)</span>, just <span class="op">=</span> <span class="st">"left"</span><span class="op">)</span></code></pre></div>
<p><img src="annotate_files/figure-html/unnamed-chunk-6-1.png" width="672" style="display: block; margin: auto;"></p>
<p>When I draw the legend, I put the legend to a position of <code>unit(1, "npc") + unit(2, "mm")</code> which is 2mm to the right of the spiral plot. To make the legend properly visible, you must set the image width larger than the image height in order to give space to the legend (in the image above, the width is 7 inch and the height is 5 inch).</p>
<p>If you also want to add title for the plot, you need to do a little bit more. One simple way is to push several viewports, as shown in the folowing code.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">grid.newpage</span><span class="op">(</span><span class="op">)</span>
<span class="va">title_height</span> <span class="op">=</span> <span class="fu">grobHeight</span><span class="op">(</span><span class="fu">textGrob</span><span class="op">(</span><span class="st">"A"</span>, gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>fontsize <span class="op">=</span> <span class="fl">14</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="fl">2</span>
<span class="fu">pushViewport</span><span class="op">(</span><span class="fu">viewport</span><span class="op">(</span>y <span class="op">=</span> <span class="fl">1</span>, height <span class="op">=</span> <span class="va">title_height</span>, just <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span><span class="op">)</span>
<span class="fu">grid.text</span><span class="op">(</span><span class="st">"This is a title"</span>, gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>fontsize <span class="op">=</span> <span class="fl">14</span><span class="op">)</span><span class="op">)</span>
<span class="fu">popViewport</span><span class="op">(</span><span class="op">)</span>

<span class="fu">pushViewport</span><span class="op">(</span><span class="fu">viewport</span><span class="op">(</span>y <span class="op">=</span> <span class="fl">0</span>, height <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">1</span>, <span class="st">"npc"</span><span class="op">)</span> <span class="op">-</span> <span class="va">title_height</span>, just <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="../reference/spiral_initialize.html">spiral_initialize</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n</span><span class="op">)</span>, newpage <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>  <span class="co"># here setting newpage = FALSE is important!</span>
<span class="fu"><a href="../reference/spiral_track.html">spiral_track</a></span><span class="op">(</span>height <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span>
<span class="fu"><a href="../reference/spiral_rect.html">spiral_rect</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n</span> <span class="op">-</span> <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">:</span><span class="va">n</span>, <span class="fl">1</span>, gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>fill <span class="op">=</span> <span class="fu">col_fun</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, col <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="../reference/spiral_highlight.html">spiral_highlight</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">100</span>, type <span class="op">=</span> <span class="st">"line"</span>, gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>col <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="../reference/spiral_highlight.html">spiral_highlight</a></span><span class="op">(</span><span class="fl">500</span>, <span class="fl">700</span>, type <span class="op">=</span> <span class="st">"line"</span>, gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>col <span class="op">=</span> <span class="st">"purple"</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/draw-dispatch.html">draw</a></span><span class="op">(</span><span class="va">lgd</span>, x <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">1</span>, <span class="st">"npc"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">2</span>, <span class="st">"mm"</span><span class="op">)</span>, just <span class="op">=</span> <span class="st">"left"</span><span class="op">)</span>

<span class="fu"><a href="../reference/spiral_clear.html">spiral_clear</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu">popViewport</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="annotate_files/figure-html/unnamed-chunk-7-1.png" width="672" style="display: block; margin: auto;"></p>
<p>One thing that needs to be noted here is, since here we are manipulating viewports, it is suggested to call <code><a href="../reference/spiral_clear.html">spiral_clear()</a></code> when the spiral plot is done so that the arrangement of viewports won’t be messed up.</p>
<p>There is also a convinient way to construct legend for horizon chart. Function <code><a href="../reference/spiral_horizon.html">spiral_horizon()</a></code> actually returns an object which later can be used in <code><a href="../reference/horizon_legend.html">horizon_legend()</a></code> to generate a legend where the legend labels are properly formatted.</p>
<p>The following plot shows the downloads of <strong>ggplot2</strong> over time:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"ggplot2_downloads.rds"</span>, package <span class="op">=</span> <span class="st">"spiralize"</span><span class="op">)</span><span class="op">)</span>
<span class="va">day_diff</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/double.html">as.double</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">date</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">]</span> <span class="op">-</span> <span class="va">df</span><span class="op">$</span><span class="va">date</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="st">"days"</span><span class="op">)</span>
<span class="va">year_mean</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tapply.html">tapply</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">count</span>, <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/year.html">year</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">date</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>

<span class="va">df</span><span class="op">$</span><span class="va">diff</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log2</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">count</span><span class="op">/</span><span class="va">year_mean</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/year.html">year</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">date</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
<span class="va">df</span><span class="op">$</span><span class="va">diff</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/is.finite.html">is.infinite</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">diff</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="fl">0</span>
<span class="va">q</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">diff</span><span class="op">)</span>, <span class="fl">0.99</span><span class="op">)</span>
<span class="va">df</span><span class="op">$</span><span class="va">diff</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">diff</span> <span class="op">&gt;</span> <span class="va">q</span><span class="op">]</span> <span class="op">=</span> <span class="va">q</span>
<span class="va">df</span><span class="op">$</span><span class="va">diff</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">diff</span> <span class="op">&lt;</span> <span class="op">-</span><span class="va">q</span><span class="op">]</span> <span class="op">=</span> <span class="op">-</span><span class="va">q</span>

<span class="fu"><a href="../reference/spiral_initialize_by_time.html">spiral_initialize_by_time</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">date</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="../reference/spiral_track.html">spiral_track</a></span><span class="op">(</span>height <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span>
<span class="va">lt</span> <span class="op">=</span> <span class="fu"><a href="../reference/spiral_horizon.html">spiral_horizon</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">date</span>, <span class="va">df</span><span class="op">$</span><span class="va">diff</span>, use_bars <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="va">lgd</span> <span class="op">=</span> <span class="fu"><a href="../reference/horizon_legend.html">horizon_legend</a></span><span class="op">(</span><span class="va">lt</span>, title <span class="op">=</span> <span class="st">"log2(difference)"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/draw-dispatch.html">draw</a></span><span class="op">(</span><span class="va">lgd</span>, x <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">1</span>, <span class="st">"npc"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">2</span>, <span class="st">"mm"</span><span class="op">)</span>, just <span class="op">=</span> <span class="st">"left"</span><span class="op">)</span></code></pre></div>
<p><img src="annotate_files/figure-html/unnamed-chunk-8-1.png" width="768" style="display: block; margin: auto;"></p>
<p>In previous examples, the spirals are always drawn in the center of images, which results in that there is large white area in the left part of the image. See the following image which is the same as the previous one but I additionally add border of the image and border of the spiral viewport.</p>
<p><img src="annotate_files/figure-html/unnamed-chunk-9-1.png" width="768" style="display: block; margin: auto;"></p>
<p>The position of the spiral viewport can be controlled with argument <code>vp_param</code> which is a list of parameters and will be sent to the function <code>viewport()</code> that contructs the spiral viewport. E.g. to move the spiral viewport to the most left of the image:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/spiral_initialize_by_time.html">spiral_initialize_by_time</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">date</span><span class="op">)</span>, vp_param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">0</span>, <span class="st">"npc"</span><span class="op">)</span>, just <span class="op">=</span> <span class="st">"left"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="../reference/spiral_track.html">spiral_track</a></span><span class="op">(</span>height <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span>
<span class="va">lt</span> <span class="op">=</span> <span class="fu"><a href="../reference/spiral_horizon.html">spiral_horizon</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">date</span>, <span class="va">df</span><span class="op">$</span><span class="va">diff</span>, use_bars <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu">grid.rect</span><span class="op">(</span>gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span><span class="op">)</span>

<span class="va">lgd</span> <span class="op">=</span> <span class="fu"><a href="../reference/horizon_legend.html">horizon_legend</a></span><span class="op">(</span><span class="va">lt</span>, title <span class="op">=</span> <span class="st">"log2(difference)"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/draw-dispatch.html">draw</a></span><span class="op">(</span><span class="va">lgd</span>, x <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">1</span>, <span class="st">"npc"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">2</span>, <span class="st">"mm"</span><span class="op">)</span>, just <span class="op">=</span> <span class="st">"left"</span><span class="op">)</span></code></pre></div>
<p><img src="annotate_files/figure-html/unnamed-chunk-10-1.png" width="768" style="display: block; margin: auto;"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Zuguang Gu.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
